<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-sm-12">
    <h2><strong><%= @inspection.equipment %></strong> (<%= @inspection.performed_at.to_date.to_s(:db) %>)</h2>
    <ol class="breadcrumb">
      <li>
        <%= link_to 'Inspections', inspections_path %>
      </li>
      <li class="active">
        <strong><%= @inspection %></strong>
      </li>
    </ol>
  </div>
</div>

<div class="wrapper wrapper-content">
  <% if @inspection.analyses.first %>
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Analyses</h5>
        </div>
        <div class="ibox-content">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Equipment</th>
                <th>Report</th>
                <th>Created</th>
                <th></th>
              </tr>
            </thead>

            <tbody>
              <% @inspection.analyses.order(created_at: :desc).each do |analysis| %>
              <tr>
                <td><%= link_to analysis, analysis %></td>
                <td class="analysis-equipment">
                  <%= analysis.analysis_requests.count %> / <%= analysis.analysis_requests.count %>
                </td>
                <td>
                  <%= link_to "View Report", report_path(analysis) %>
                </td>
                <td>
                  <%= analysis.created_at %>
                </td>
                <td class="project-actions">
                  <%= link_to analysis, class: 'btn btn-white btn-xs' do %>
                  <i class="fa fa-refresh"></i>
                  <% end %>
                  <%= link_to analysis, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-xs' do %>
                  <i class="fa fa-times"></i>
                  <% end %>
                </td>
              </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <% end %>

  <div class="row">
    <div class="col-sm-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Report Details</h5>
          <div class="ibox-tools">
            <%= link_to edit_inspection_path(@inspection), class: 'btn btn-primary btn-xs' do %>
            <i class="fa fa-pencil"></i> Edit
            <% end %>
          </div>
        </div>
        <div class="ibox-content">
          <p><% unless @inspection.equipment %><span class="text-danger">Please assign equipment to this report to enable finalizing (and start processing).</span><% end %></p>
          <dl class="dl-horizontal">
            <dt>Equipment</dt>
            <dd>
              <% if @inspection.equipment %>
              <%= link_to @inspection.equipment, @inspection.equipment %>
              <% else %>
              <span class="text-danger">Unassigned</span>
              <% end %>
            </dd>
            <dt>File Count</dt>
            <dd><%= @inspection.inspection_files.count %></dd>
            <dt>Finalized</dt>
            <dd>
              Not finalized
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-12">
      <div class="ibox">
        <div class="ibox-title">
          <h5>Files</h5>
        </div>
        <div class="ibox-content">
          <% unless @inspection.analyses.count > 0 %>
          <div class="well">
            <form action="#">
              <input type="file" multiple="" data-presign-path="<%= presign_inspection_files_path %>" data-success-path="<%= inspection_inspection_files_path(@inspection) %>" } %>
            </form>
          </div>
          <% end %>

          <%= render 'inspection_files/inspection_files_by_group', inspection_files: @inspection.inspection_files %>

          <h4>Some files not matched correctly?</h4>
          <%= button_to match_scan_protocols_inspection_path(@inspection), class: 'btn btn-white btn-lg btn-block', method: :post do %>
          <i class="fa fa-flask"></i>
          Match Scan Protocols
          <% end %>

          <h4>Need your files back?</h4>
          <%= link_to download_files_inspection_path(@inspection), class: 'btn btn-white btn-lg btn-block' do %>
          <i class="fa fa-download"></i>
          Download
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <% if @inspection.inspection_files.count > 0 %>
  <div class="row">
    <div class="col-sm-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Processing</h5>
        </div>

        <div class="ibox-content">
          <% if @inspection.analyses.count > 0 %>
          <h4>Something went wrong?</h4>
          <%= link_to "Process again", inspection_analyses_path(@inspection), class: 'btn btn-white btn-lg btn-block', method: :post %>
          <% else %>
          <h4>Done uploading?</h4>
          <%= link_to "Start processing", inspection_analyses_path(@inspection), class: 'btn btn-primary btn-lg btn-block', method: :post %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <% end %>
</div>
